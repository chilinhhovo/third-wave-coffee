<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brewed, Branded, and Beige</title>
  <style>
    /* Import Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;500;700&display=swap');

    body {
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      background: #f6f3ee;
      color: #2d2320;
      line-height: 1.7;
      margin: 0;
      padding: 0;
    }

    h1, h2, h3, h4 {
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: -1px;
      color: #2d2320;
      text-align: left;
      margin-bottom: 1.2rem;
      line-height: 1.15;
    }

    h1 {
      font-size: 3.8rem;
      color: #1e1a16;
      margin-bottom: 0.5rem;
      text-transform: none;
      letter-spacing: -2px;
    }
    
    
    hr, .divider, .horizontal-line {
    display: none !important;
    border: none !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    visibility: hidden !important;
  }

    h2 {
      font-size: 2.4rem;
      color: #8B4513;
      border: none;
      background: none;
      padding: 0;
      margin-top: 3rem;
      margin-bottom: 1.5rem;
      text-shadow: none;
    }

    h3 {
      font-size: 1.5rem;
      color: #1e1a16;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    h4 {
      font-size: 1.3rem;
      color: #2d2320;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }

    p, ul, ol {
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      font-size: 1.13rem;
      color: #2d2320;
      margin-bottom: 1.5rem;
      line-height: 1.8;
      max-width: 700px;
    }

    strong {
      color: #8B4513;
      font-weight: 700;
    }

    blockquote {
      margin: 2rem 0;
      padding: 1.5rem 2rem;
      border-left: 4px solid #8B4513;
      background: #f0e7de;
      font-style: italic;
      color: #1e1a16;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }

    /* Layout */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    header {
      background: linear-gradient(120deg, #8B4513 0%, #D2B48C 100%);
      padding: 6rem 0 4rem;
      position: relative;
      overflow: hidden;
      border-bottom: none;
    }
    
    header::before {
      /* Remove the animated background image */
      display: none !important;
    }
    
    .header-content {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: 0 2rem 0 10rem;
      text-align: left;
    }
    
    header h1 {
      color: #fff;
      text-shadow: 2px 2px 0 #8B4513, 0 2px 8px rgba(0,0,0,0.08);
      font-size: 4.2rem;
      margin-bottom: 1.2rem;
      white-space: nowrap;
    }
    
    header p {
      color: #fff;
      font-size: 1.5rem;
      max-width: 700px;
      margin-bottom: 2rem;
      text-shadow: 1px 1px 1px rgba(0,0,0,0.08);
    }
    
    .byline {
      font-size: 1.1rem;
      color: #fff;
      font-weight: 500;
      margin-top: 1rem;
      margin-bottom: 0;
      text-align: left;
    }
    
    .byline a {
      color: #fff;
      text-decoration: underline;
      border-bottom: 1px solid #fff;
      transition: border-color 0.2s;
    }
    
    .byline a:hover {
      border-color: #8B4513;
    }
    
    section {
      padding: 4rem 0;
      position: relative;
    }
    
    section:nth-child(odd) {
      background-color: #fafafa;
    }
    
    .section-inner {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    .overview-section {
      background: none;
      box-shadow: none;
      border: none;
      padding: 0 0 2rem 0;
      margin: 3rem 0 0 0;
      max-width: 700px;
      margin-left: 12rem;
      margin-right: auto;
    }
    
    .overview-content {
      max-width: 700px;
      margin: 0 auto;
      line-height: 1.8;
      background: none;
      box-shadow: none;
      border: none;
    }
    
    .emphasis {
      color: #8B4513;
      font-style: italic;
      font-weight: 600;
    }
    
    /* Beige Indicator */
    .beige-word {
      position: relative;
      display: inline;
      font-weight: normal;
    }
    
    .beige-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      margin-left: 5px;
      background-color: #f5f0e5;
      border: 1px solid #e5ddd0;
      border-radius: 2px;
    }
    
    /* Maps and Visuals */
    .map-section {
      background-color: white;
      padding: 4rem 0;
    }
    
    .map-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 3rem auto;
      padding: 0 2rem;
    }
    
    .map-grid figure {
      margin: 0;
      background: white;
      box-shadow: none !important;
      transition: none !important;
      border: 1px solid #f0f0f0;
    }
    
    .map-grid figure:hover {
      transform: none !important;
      box-shadow: none !important;
    }
    
    .map-grid img {
      width: 100%;
      height: auto;
      border-bottom: 1px solid #f5f5f5;
    }
    
    .map-grid figcaption {
      padding: 1rem 1.5rem;
      font-size: 1rem;
      line-height: 1.5;
      color: #444;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }
    
    .full-map {
      width: 100%;
      max-width: 840px;
      height: auto;
      margin: 2rem auto;
      box-shadow: none;
      overflow: hidden;
      border: none;
      padding: 0 2rem;
      position: relative;
    }
    
    .full-map img {
      width: 100%;
      max-width: 720px;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
      transition: opacity 0.7s cubic-bezier(0.4,0,0.2,1);
      opacity: 0;
      pointer-events: none;
    }
    .full-map img.active {
      opacity: 1;
      pointer-events: auto;
      position: relative;
    }
    .full-map.scrolly-container {
      position: relative;
      min-height: 400px;
      height: auto;
      background: none;
    }
    
    .svg-container {
      width: 100%;
      height: 350px;
      margin: 0 auto 2rem auto;
      background: #f6f3ee;
      border: none;
      box-shadow: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .svg-container iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #f6f3ee;
    }
    
    .loading-message {
      display: none;
    }
    
    /* City Grid */
    .city-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 2.5rem;
      max-width: 1200px;
      margin: 4rem auto;
      padding: 0 2rem;
      background: none;
      border: none;
      box-shadow: none;
    }
    
    .city-container {
      background: none;
      border: none;
      box-shadow: none;
      overflow: visible;
      display: flex;
      flex-direction: column;
      height: 500px;
      transition: none;
    }
    
    .city-container:hover {
      transform: none !important;
      box-shadow: none !important;
    }
    
    .city-info {
      padding: 0 0 1rem 0;
      border-bottom: none;
    }
    
    .city-name {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #333;
    }
    
    .city-description {
      font-size: 1rem;
      color: #666;
      margin-bottom: 1rem;
      font-style: italic;
      font-family: 'Georgia', serif;
    }
    
    .color-palette {
      display: flex;
      height: 32px;
      margin: 1rem 0;
      border-radius: 6px;
      overflow: hidden;
      border: none;
    }
    
    .color-swatch {
      flex: 1;
    }
    
    .city-container .svg-container {
      flex: 1;
      margin: 0;
      width: 100%;
      height: auto;
      min-height: 250px;
      box-shadow: none;
      border: none;
    }
    
    /* Comparison Sections */
    .comparison-section {
      background: none;
      padding: 6rem 0 2rem 0;
      border: none;
      box-shadow: none;
    }
    
    .color-comparison,
    .text-comparison {
      display: flex;
      flex-direction: column;
      gap: 3rem;
      max-width: 1000px;
      margin: 4rem auto;
      padding: 0 2rem;
      background: none;
      border: none;
      box-shadow: none;
    }
    
    .color-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      max-width: 1000px;
      margin: 4rem auto;
      padding: 0 2rem;
    }
    
    .color-profile,
    .text-profile {
      background: none;
      border: none;
      box-shadow: none;
      padding: 2rem 0 0 0;
    }
    
    .color-profile-title,
    .text-profile-title {
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
      color: #8B4513;
      text-align: left;
      border-bottom: none !important;
      padding-bottom: 0.5rem;
      display: inline-block;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      font-weight: 700;
    }
    
    .color-profile img,
    .text-profile img {
      width: 100%;
      height: auto;
      border: none;
      background: transparent;
      border-radius: 6px;
    }
    
    /* Map Comparisons */
    .comparison-maps {
      padding: 4rem 0;
      background: none;
      border: none;
      box-shadow: none;
    }
    
    .map-pair {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      max-width: 1200px;
      margin: 3rem auto;
      padding: 0 2rem;
      background: none;
      border: none;
      box-shadow: none;
    }
    
    .map-container {
      background: none;
      border: none;
      box-shadow: none;
      padding: 0;
      overflow: visible;
    }
    
    .map-container img {
      width: 100%;
      height: auto;
      border-radius: 6px;
      border: none;
    }
    
    .map-container figcaption {
      padding: 1.5rem 0 0.5rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #8B4513;
      border-bottom: none;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      padding: 1rem;
    }
    
    .map-container p {
      padding: 0 0 1.5rem 0;
      margin-bottom: 0;
      font-size: 1rem;
      color: #2d2320;
      padding: 1rem;
    }
    
    /* Final Sections */
    .final-view {
      background: #f6f3ee;
      color: #2d2320;
      padding: 8rem 0;
      position: relative;
      overflow: hidden;
      border-top: none;
      border-bottom: none;
      box-shadow: none;
    }
    
    .final-content {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    .final-view h2 {
      color: #8B4513;
      font-size: 2.5rem;
      border-bottom: none !important;
      margin-bottom: 2rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }
    
    .final-view p {
      color: #2d2320;
      font-size: 1.3rem;
      margin-bottom: 2rem;
      text-shadow: none;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }
    
    /* Methodology Section */
    .methodology-new {
      max-width: 900px;
      margin: 5rem auto;
      background: #f0e7de;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(139, 69, 19, 0.07);
      padding: 0;
      overflow: visible;
    }
    .methodology-toggle {
      width: 100%;
      background: #8B4513;
      color: #fff;
      font-size: 1.3rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      font-weight: 700;
      border: none;
      border-radius: 8px 8px 0 0;
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      outline: none;
    }
    .methodology-toggle:focus, .methodology-toggle:hover {
      background: #a05a2c;
      box-shadow: 0 2px 8px rgba(139,69,19,0.10);
    }
    .methodology-toggle-icon {
      font-size: 2rem;
      margin-left: 1rem;
      transition: transform 0.2s;
    }
    .methodology-toggle[aria-expanded="true"] .methodology-toggle-icon {
      transform: rotate(45deg);
    }
    .methodology-content-new {
      padding: 2rem;
      background: #fff;
      border-radius: 0 0 8px 8px;
      color: #2d2320;
      font-size: 1.08rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }
    
    /* Footer */
    footer {
      background: #8B4513;
      color: #fff;
      padding: 4rem 0;
      border-top: 4px solid #8B4513;
    }
    
    .footer-content {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    footer p {
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 1rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }
    
    footer a {
      color: #ffbd59;
      text-decoration: none;
      transition: color 0.2s;
    }
    
    footer a:hover {
      color: #fff;
      text-decoration: none;
    }
    
    /* Button for methodology toggle */
    .toggle-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
    }
    
    /* List Styling */
    ul, ol {
      margin-left: 2rem;
      margin-bottom: 2rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }
    
    li {
      margin-bottom: 0.8rem;
      font-size: 1.1rem;
      line-height: 1.6;
      color: #444;
    }
    
    /* Accent Colors */
    .accent-orange {
      color: #ff9e54;
    }
    
    .accent-pink {
      color: #f5a9e1;
    }
    
    .accent-yellow {
      color: #ffbd59;
    }
    
    .accent-lavender {
      color: #e0c1f0;
    }
    
    /* Additional Visual Elements */
    .section-divider {
      display: none;
    }
    
    .highlight-box {
      background-color: #fff9f2;
      border-left: 3px solid #ff9e54;
      padding: 2rem;
      margin: 2rem 0;
    }
    
    .highlight-box p:last-child {
      margin-bottom: 0;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 1200px) {
      h1 {
        font-size: 3rem;
      }
      .map-pair {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      .color-comparison {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }
      h2 {
        font-size: 1.8rem;
      }
      header {
        padding: 4rem 0 2rem;
      }
      .overview-section {
        padding: 1.5rem 0.5rem;
      }
      .city-grid {
        gap: 1.2rem;
      }
      .final-view {
        padding: 4rem 0;
      }
      .final-view p {
        font-size: 1.1rem;
      }
    }

    .color-grid-gallery {
      margin: 4rem 0;
      padding: 0 0 2rem 0;
      background: none;
      border-top: 1px solid #eee;
    }

    .color-grid-gallery h2 {
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #222;
      font-weight: 700;
      letter-spacing: -1px;
    }

    .color-grid-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: none;
      border: none;
      padding: 0;
    }

    .color-grid-svg {
      width: 90vw;
      max-width: 700px;
      height: 70vw;
      max-height: 700px;
      border: 1px solid #eee;
      background: #fafafa;
      transition: box-shadow 0.2s;
    }

    .color-grid-tooltip {
      margin-top: 1rem;
      font-size: 1.1rem;
      color: #555;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 4px;
      padding: 0.5rem 1rem;
      min-width: 120px;
      text-align: center;
      box-shadow: none;
    }

    #Layer_1 {
      width: 100%;
      max-width: 1050px; /* Combined width of Barcelona, Berlin, and Bangkok divs */
      margin: 0 auto;
    }

    .color-profile-title,
    .text-profile-title {
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      font-weight: 700;
      color: #8B4513;
      text-align: left;
      border-bottom: none !important;
      padding-bottom: 0.5rem;
      display: inline-block;
    }

    .map-container figcaption {
      padding: 1.5rem 0 0.5rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #8B4513;
      border-bottom: none;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      padding: 1rem;
    }

    .map-container p {
      padding: 0 0 1.5rem 0;
      margin-bottom: 0;
      font-size: 1rem;
      color: #2d2320;
      padding: 1rem;
    }

    /* 3. Move city names inside map boxes */
    /* Update HTML for map-pair sections: move h4 city names into .map-container as <div class="city-title"> */

    /* 4. City-specific predictor lines font */
    .map-pair li {
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif !important;
      font-size: 1.1rem;
      color: #444;
    }

    /* 5. Add style for city title inside map-container */
    .city-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #8B4513;
      margin-bottom: 0.5rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      text-align: left;
      padding: 0.5rem 1rem 0.5rem 1rem;
      background: #f6f3ee;
      border-radius: 6px;
    }

    /* 6. Collapsible sections for mobile */
    @media (max-width: 700px) {
      .collapsible-section .collapsible-toggle {
        display: block;
        width: 100%;
        background: #f6f3ee;
        color: #8B4513;
        border: none;
        font-size: 1.1rem;
        font-weight: 700;
        text-align: left;
        padding: 1rem 0.5rem;
        cursor: pointer;
        margin-bottom: 0.5rem;
        border-radius: 6px;
      }
      .collapsible-section .collapsible-content {
        display: none;
        padding: 0 0.5rem 1rem 0.5rem;
      }
      .collapsible-section.active .collapsible-content {
        display: block;
      }
    }

    @media (min-width: 701px) {
      .collapsible-section .collapsible-toggle {
        display: none;
      }
      .collapsible-section .collapsible-content {
        display: block !important;
        padding: 0;
      }
    }

    /* Keep Amsterdam map contained when zoomed */
    #amsterdam-map-figure {
      overflow: hidden;
      width: 100%;
      max-width: 1200px;
      height: 500px;
      margin: 0 auto 2rem auto;
      background: #fafafa;
      border-radius: 8px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      box-sizing: border-box;
    }
    #amsterdam-map-img {
      max-width: 100%;
      max-height: 420px;
      width: auto;
      height: auto;
      display: block;
      margin: 0 auto;
      transition: transform 0.2s;
    }

    #amsterdam-map-figure figcaption {
      background: #fff;
      padding: 2.5rem 3rem;
      border-radius: 0 0 8px 8px;
      margin: 0;
      width: 100%;
      min-height: 80px;
      box-shadow: none;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      color: #444;
      font-size: 1rem;
      line-height: 1.5;
      word-break: break-word;
      text-align: left;
      position: static;
    }

    #amsterdam-map-figure {
      position: relative;
    }

    .text-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      max-width: 1000px;
      margin: 4rem auto;
      padding: 0 2rem;
      background: none;
      border: none;
      box-shadow: none;
    }

    /* Scrollytelling fade effect */
    .scrolly-fade {
      opacity: 0;
      transition: opacity 0.7s cubic-bezier(0.4,0,0.2,1);
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
      pointer-events: none;
    }
    .scrolly-fade.active {
      opacity: 1;
      pointer-events: auto;
      position: relative;
    }
    .full-map.scrolly-container {
      position: relative;
      min-height: 400px;
      height: auto;
    }

    /* Scrollytelling styles */
    .scrolly-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      max-width: 900px;
      margin: 3rem auto 3rem auto;
      gap: 0;
      background: none;
      padding: 0 1rem;
    }
    .sticky-thing {
      position: sticky;
      top: 10vh;
      width: 100%;
      max-width: 700px;
      min-height: 400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: none;
      z-index: 1;
    }
    .sticky-thing img {
      width: 100%;
      max-width: 700px;
      height: auto;
      background: none;
      box-shadow: none;
      border: none;
      display: none;
      margin: 0 auto;
    }
    .sticky-thing img.active {
      display: block;
    }
    @media (max-width: 900px) {
      .scrolly-container {
        max-width: 98vw;
        padding: 0 0.5rem;
      }
      .sticky-thing {
        max-width: 98vw;
        min-height: 200px;
        top: 0;
      }
      .steps-container {
        max-width: 98vw;
        margin: 0 auto;
      }
      .sticky-thing img {
        max-width: 98vw;
      }
      .step-textbox {
        max-width: 98vw;
        padding: 1.2rem 0.5rem;
        font-size: 1rem;
      }
    }

    .step-textbox {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(139, 69, 19, 0.07);
      padding: 1.5rem 2rem;
      border-left: 6px solid #8B4513;
      max-width: 700px;
      width: 100%;
      margin: 1.5rem auto 0 auto;
      position: static;
      left: auto;
      bottom: auto;
      top: auto;
      transform: none;
      opacity: 1;
      pointer-events: auto;
      z-index: 1;
      font-size: 1.08rem;
      color: #444;
      text-align: left;
      transition: none;
    }
    .step-textbox.active {
      opacity: 1 !important;
      pointer-events: auto;
      transform: none !important;
    }
    .step-textbox.fading {
      opacity: 0;
      pointer-events: none;
      transform: none;
    }
    .overlay-steps {
      position: static;
      left: auto; right: auto; top: auto; bottom: auto;
      width: 100%;
      height: auto;
      pointer-events: none;
      z-index: 1;
      display: block;
      align-items: unset;
      justify-content: unset;
    }
    .sticky-thing {
      position: sticky;
      top: 10vh;
      width: 100%;
      max-width: 700px;
      min-height: 400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: none;
      z-index: 1;
    }
    .sticky-thing img {
      width: 100%;
      max-width: 700px;
      height: auto;
      background: none;
      box-shadow: none;
      border: none;
      display: none;
      margin: 0 auto;
    }
    .sticky-thing img.active {
      display: block;
    }
    @media (max-width: 900px) {
      .step-textbox {
        max-width: 98vw;
        padding: 0.5rem 0.2rem 1rem 0.2rem;
        font-size: 0.95rem;
      }
      .sticky-thing {
        max-width: 98vw;
        min-height: 200px;
      }
      .sticky-thing img {
        max-width: 98vw;
      }
    }

    .step {
      min-height: 60vh;
      margin: 0;
      padding: 0;
      background: none;
      border: none;
    }
    .steps-container {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    @media (max-width: 900px) {
      .steps-container {
        max-width: 98vw;
        margin: 0 auto;
      }
      .sticky-thing {
        max-width: 98vw;
        min-height: 200px;
        top: 0;
      }
    }

    /* Add CSS for chart-annotation overlays */
    .chart-annotation {
      position: absolute;
      top: 2.5%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.92);
      color: #8B4513;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(139,69,19,0.07);
      z-index: 2;
      pointer-events: none;
      max-width: 90%;
      text-align: center;
      display: none;
    }
    @media (max-width: 900px) {
      .chart-annotation {
        font-size: 0.95rem;
        padding: 0.5rem 0.7rem;
        max-width: 98vw;
      }
    }

    /* Make scrollytelling charts larger for better SVG visibility */
    .sticky-thing {
      max-width: 1100px;
      min-height: 500px;
    }
    .sticky-thing img {
      max-width: 1100px;
    }
    @media (max-width: 1200px) {
      .sticky-thing {
        max-width: 98vw;
        min-height: 300px;
      }
      .sticky-thing img {
        max-width: 98vw;
      }
    }

    /* Make scrollytelling charts even larger and reduce space below overlay text */
    .sticky-thing {
      max-width: 1400px;
      min-height: 650px;
      height: 70vh;
    }
    .sticky-thing img {
      max-width: 1400px;
      height: 60vh;
    }
    .step-textbox {
      margin: 1.2rem auto 0 auto;
      max-width: 1200px;
      width: 100%;
      padding: 1.2rem 2rem 1.2rem 2rem;
    }
    @media (max-width: 1600px) {
      .sticky-thing {
        max-width: 98vw;
        min-height: 350px;
        height: 50vw;
      }
      .sticky-thing img {
        max-width: 98vw;
        height: 40vw;
      }
      .step-textbox {
        max-width: 98vw;
        padding: 1rem 0.5rem;
      }
    }

    .methodology-static {
      display: inline-block;
      background: #f0e7de;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(139, 69, 19, 0.07);
      padding: 0 0 1.2rem 0;
      margin: 3rem auto 2rem auto;
      min-width: 320px;
      max-width: 98vw;
    }
    .methodology-static h2 {
      background: #8B4513;
      color: #fff;
      font-size: 1.2rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
      font-weight: 700;
      border-radius: 8px 8px 0 0;
      margin: 0;
      padding: 0.8rem 1.2rem;
    }
    .methodology-content-static {
      padding: 1.2rem 1.2rem 0.5rem 1.2rem;
      background: #fff;
      border-radius: 0 0 8px 8px;
      color: #2d2320;
      font-size: 1.02rem;
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }

    @media (max-width: 700px) {
      .header-content {
        max-width: 98vw !important;
        padding: 0 1rem !important;
        margin: 0 auto !important;
        text-align: left !important;
        display: block !important;
        padding-left: 0 !important;
      }
      header h1 {
        font-size: 2.1rem !important;
        white-space: normal !important;
        word-break: break-word !important;
        margin-bottom: 1.2rem !important;
        text-align: left !important;
      }
      header p {
        font-size: 1.1rem !important;
        margin-bottom: 1.2rem !important;
        text-align: left !important;
      }
      .byline {
        font-size: 1rem !important;
        margin-top: 0.5rem !important;
        margin-bottom: 0 !important;
        text-align: left !important;
      }
    }

    .full-map .world-map {
      opacity: 1 !important;
      pointer-events: auto !important;
      position: static !important;
    }
  </style>
</head>

<body>
  <header>
    <div class="header-content">
      <h1>Brewed, Branded, and Beige</h1>
      <p>Thousands of third-wave cafés across 91 cities reveal a surprisingly uniform color code for cool.</p>
      <div class="byline"><a href="https://chilinhhovo.github.io/"> Chi Vo</a></div>
    </div>
  </header>

  <div class="container">
    <div class="overview-section collapsible-section">
      <button class="collapsible-toggle" aria-expanded="false">Overview</button>
      <div class="collapsible-content">
        <p>
          Coffee prices surged in 2024 and 2025 as droughts in Brazil and Vietnam pushed beans to their highest levels in over a decade. But even as costs rise, the global appetite for carefully made, beautifully presented coffee keeps growing. From Tokyo to Tulum, third-wave cafés are shaping not just how we drink, but how we design, brand, and live.
        </p>
        
        <h2>The Evolution of Coffee Culture</h2>
        <p>
          Coffee has always mirrored its era. The first wave emphasized convenience: mass-produced tins, instant brews, and speed over ceremony. The second wave shifted focus to experience, ushered in by espresso culture, branded baristas, and the rise of Starbucks.
        </p>
        <p>
          The third wave reimagines coffee as craft. This global movement emphasizes origin, process, and aesthetic. Cafés highlight single-origin beans, pour-over rituals, and hand-thrown ceramics. Design is central. Interiors often feature raw wood, soft light, and minimal ornamentation, projecting values like care, sustainability, and intentional living.
        </p>
        <p> 
          As sociologist John Manzo writes in <a href="https://nsuworks.nova.edu/tqr/vol20/iss6/2/">The Qualitative Report (2015)</a>, third-wave coffeehouses are "venues where face-to-face sociability thrives," even as many traditional gathering places fade from urban life.
        </p>
        <p>
          From Copenhagen to Chiang Mai, a shared visual language has emerged. Despite cultural differences, third-wave cafés around the world speak in the same tones: beige walls, terrazzo counters, curated playlists, and artisanal details. These choices are not just about taste. They signal a worldview shaped by slowness, transparency, and quiet aspiration.
        </p>

        <p>This movement is less about caffeine, and more about values: care, craft, and quiet connection.</p>
    
        <p>
          More than 5,000 third-wave coffee shops across 91 cities were mapped and analyzed. Visual elements from Instagram and websites were compared to better understand how the aesthetic of third-wave coffee spreads and adapts across different urban settings.
        </p>
      </div>
    </div>
  </div>

  <section class="map-section">
    <div class="section-inner">
      <h2>The Geography of Third-Wave Coffee</h2>
      <p>
        In city after city, café locations reflect broader social and spatial patterns. In Amsterdam, shops cluster west of the Centrum, near residential canals. Berlin hotspots appear in Kreuzberg, Neukölln, and Mitte. In Chiang Mai, cafés stretch from Old Town to Nimman.
      </p>
      <p>
        In Europe, cafés are distributed across dense, walkable neighborhoods. In Southeast Asia, they gather in tourist corridors and digital nomad zones. In North America, they appear most often in affluent areas undergoing creative redevelopment.
      </p>
    </div>
    
    <div class="full-map">
      <img src="global_thirdwave_map.png" alt="World map of third-wave coffee shops" class="world-map">
    </div>
    
    <div class="map-grid">
      <figure class="svg-container" style="margin-bottom: 0; align-self: flex-start; position: relative; background: #fff; border-radius: 8px; box-shadow: none; padding: 0; width: 100%; max-width: 100%; height: 500px; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden;">
        <img id="amsterdam-map-img" src="output_svgs/map_amsterdam.svg" alt="Amsterdam coffee map" style="transition: transform 0.2s; max-width: 100%; max-height: 350px; width: auto; height: auto; display: block; margin: 0 auto;">
        <figcaption>Amsterdam: Dotted with canals and caffeine, most cafés cluster on the west side of the Centrum.</figcaption>
      </figure>
  
      <figure class="svg-container" style="margin-bottom: 0; align-self: flex-start; position: relative; background: #fff; border-radius: 8px; box-shadow: none; padding: 0; width: 100%; max-width: 100%; height: 500px; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden;">
        <img id="barcelona-map-img" src="output_svgs/map_barcelona.svg" alt="Barcelona coffee map" style="transition: transform 0.2s; max-width: 100%; max-height: 350px; width: auto; height: auto; display: block; margin: 0 auto;">
        <figcaption>Barcelona: A tight spread across Eixample and Sant Antoni, not far from La Familia, and Gaudí's legacies.</figcaption>
      </figure>
  
      <figure class="svg-container" style="margin-bottom: 0; align-self: flex-start; position: relative; background: #fff; border-radius: 8px; box-shadow: none; padding: 0; width: 100%; max-width: 100%; height: 500px; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden;">
        <img id="berlin-map-img" src="output_svgs/map_berlin-01.svg" alt="Berlin coffee map" style="transition: transform 0.2s; max-width: 100%; max-height: 350px; width: auto; height: auto; display: block; margin: 0 auto;">
        <figcaption>Berlin: Third-wave hotspots orbit Kreuzberg, Neukölln, and Mitte's creative quarters.</figcaption>
      </figure>
  
      <figure class="svg-container" style="margin-bottom: 0; align-self: flex-start; position: relative; background: #fff; border-radius: 8px; box-shadow: none; padding: 0; width: 100%; max-width: 100%; height: 500px; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden;">
        <img id="bali-map-img" src="output_svgs/map_bali.svg" alt="Bali coffee map" style="transition: transform 0.2s; max-width: 100%; max-height: 350px; width: auto; height: auto; display: block; margin: 0 auto;">
        <figcaption>Bali (Canggu): Cafés map perfectly onto surf-town sprawl and coworking enclaves.</figcaption>
      </figure>
  
      <figure class="svg-container" style="margin-bottom: 0; align-self: flex-start; position: relative; background: #fff; border-radius: 8px; box-shadow: none; padding: 0; width: 100%; max-width: 100%; height: 500px; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden;">
        <img id="chiangmai-map-img" src="output_svgs/map_chiang_mai.svg" alt="Chiang Mai coffee map" style="transition: transform 0.2s; max-width: 100%; max-height: 350px; width: auto; height: auto; display: block; margin: 0 auto;">
        <figcaption>Chiang Mai: From Old Town to Nimman, every block brews something new.</figcaption>
      </figure>
  
      <figure class="svg-container" style="margin-bottom: 0; align-self: flex-start; position: relative; background: #fff; border-radius: 8px; box-shadow: none; padding: 0; width: 100%; max-width: 100%; height: 500px; display: flex; flex-direction: column; justify-content: flex-start; overflow: hidden;">
        <img id="chiangrai-map-img" src="output_svgs/map_chiang_rai.svg" alt="Chiang Rai coffee map" style="transition: transform 0.2s; max-width: 100%; max-height: 350px; width: auto; height: auto; display: block; margin: 0 auto;">
        <figcaption>Chiang Rai: Small but dense with a surprising number of roasters near the night market.</figcaption>
      </figure>
    </div>

    <div class="section-inner geography-intro" style="padding-left: 3rem;">
      <p>
        The geography of third-wave cafés tells us as much about a city's social fabric as it does about coffee itself. In European cities like <strong>Berlin</strong>, <strong>Warsaw</strong>, and <strong>Amsterdam</strong>, coffee shops tend to be more evenly spread, mirroring the density and walkability of older urban cores. In contrast, cities like <strong>Bangkok</strong>, <strong>Phuket</strong>, and <strong>Bali</strong> show cafés clustered tightly around tourist zones, creative enclaves, or beach-adjacent nomad hubs. In North America, patterns skew toward affluence: in <strong>Dallas</strong>, <strong>Denver</strong>, and <strong>San Diego</strong>, third-wave cafés often align with gentrified neighborhoods or near tech and creative industry zones. What emerges is a global map of taste, not just for coffee, but for lifestyle.
      </p>
    </div>
  </section>

  <section class="comparison-section">
    <div class="section-inner">
      <h2>The Global Coffee Palette</h2>
      <p>Neutral tones dominate the design of third-wave cafés. Across cities, beige, stone, and soft gray form the foundation of the visual language. These tones suggest calm, restraint, and comfort.</p>
      
      <p>Subtle color variations mark regional character. In Toronto, muted blues temper concrete and clay. In Bangkok, tropical woods pair with bold accents. Medellín blends warm grays with natural light. Melbourne's palette of wood, stone, and metal reflects a balance of industrial and cozy.</p>
      <p>
        "The look is minimal, warm, tactile," said Arindam Sengupta, founder of Rabbithole India and former chief creative officer at TBWA/Egypt. "Think light wood, raw concrete, soft linen. The palette stays neutral so the color comes from the coffee, the pastries, the people."
      </p>
    </div>
    
    <div class="svg-container">
      <iframe src="output_color_squares/all_cities_combined.svg" title="All cities combined color grid" id="allCitiesFrame" style="width:100%; height:700px;"></iframe>
      <div class="loading-message">Loading combined visualization...</div>
    </div>
    
    <div class="section-inner svg-explanation-lower" style="margin-top:11rem; padding: 3rem 0 4rem 0;">
      <div style="max-width:900px; margin:0 auto; font-size:1.13rem; color:#2d2320; background:#f6f3ee; border-radius:12px; padding:2.5rem 3rem; box-shadow:none;">
        Third-wave coffee culture has created a consistent global style while still leaving room for local identity and individual expression. It reveals a balance between uniformity and variation, where each city's café scene feels both familiar and distinctly its own.
      </div>
    </div>

    <div class="city-grid">
      <div class="city-container">
        <div class="city-info">
          <h3 class="city-name">Barcelona</h3>
          <p class="city-description">Mediterranean warmth blends with modernist elements</p>
          <div class="color-palette">
            <div class="color-swatch" style="background-color: #3d332d;"></div>
            <div class="color-swatch" style="background-color: #cfc8c2;"></div>
            <div class="color-swatch" style="background-color: #a3907f;"></div>
            <div class="color-swatch" style="background-color: #b2abb3;"></div>
            <div class="color-swatch" style="background-color: #506e8f;"></div>
          </div>
        </div>
        
        <div class="svg-container">
          <iframe src="output_color_squares/color_grid_Barcelona.svg" title="Barcelona coffee color grid"></iframe>
          <div class="loading-message">Loading Barcelona visualization...</div>
        </div>
      </div>
    
      <div class="city-container">
        <div class="city-info">
          <h3 class="city-name">Bangkok</h3>
          <p class="city-description">Tropical woods with bright accent colors</p>
          <div class="color-palette">
            <div class="color-swatch" style="background-color: #ded7ce;"></div>
            <div class="color-swatch" style="background-color: #4d443e;"></div>
            <div class="color-swatch" style="background-color: #c5b7a1;"></div>
            <div class="color-swatch" style="background-color: #a85b3b;"></div>
            <div class="color-swatch" style="background-color: #1f1d1b;"></div>
          </div>
        </div>
        
        <div class="svg-container">
          <iframe src="output_color_squares/color_grid_Bangkok.svg" title="Bangkok coffee color grid"></iframe>
          <div class="loading-message">Loading Bangkok visualization...</div>
        </div>
      </div>
      
      <div class="city-container">
        <div class="city-info">
          <h3 class="city-name">Toronto</h3>
          <p class="city-description">A blend of clay, concrete, and soft cool tones, shades that temper earthiness with moments of blue, giving the cafés a balanced, breathable calm</p>
          <div class="color-palette">
            <div class="color-swatch" style="background-color: #3E3B3D;"></div>
            <div class="color-swatch" style="background-color: #D5CBC2;"></div>
            <div class="color-swatch" style="background-color: #9EC1C1;"></div>
            <div class="color-swatch" style="background-color: #988168;"></div>
            <div class="color-swatch" style="background-color: #B8B3A8;"></div>
          </div>
        </div>
        
        <div class="svg-container">
          <iframe src="output_color_squares/color_grid_Toronto.svg" title="Toronto coffee color grid"></iframe>
          <div class="loading-message">Loading Berlin visualization...</div>
        </div>
      </div>

      <div class="city-container">
        <div class="city-info">
          <h3 class="city-name">Medellin</h3>
          <p class="city-description">Shades brewed from stone, soil, and soft sunlight, reflecting the rustic minimalism of contemporary design</p>
          <div class="color-palette">
            <div class="color-swatch" style="background-color: #463D35;"></div>
            <div class="color-swatch" style="background-color: #D3C8BC;"></div>
            <div class="color-swatch" style="background-color: #6C6E62;"></div>
            <div class="color-swatch" style="background-color: #AEA18C;"></div>
            <div class="color-swatch" style="background-color: #222020;"></div>
          </div>
        </div>
        
        <div class="svg-container">
          <iframe src="output_color_squares/color_grid_Medellin.svg" title="Medellin coffee color grid"></iframe>
          <div class="loading-message">Loading Los Angeles visualization...</div>
        </div>
      </div>

      <div class="city-container">
        <div class="city-info">
          <h3 class="city-name">London</h3>
          <p class="city-description">British sensibility with modern pops of color</p>
          <div class="color-palette">
            <div class="color-swatch" style="background-color: #4E342E;"></div>
            <div class="color-swatch" style="background-color: #a28c60;"></div>
            <div class="color-swatch" style="background-color: #A1887F;"></div>
            <div class="color-swatch" style="background-color: #E0E0E0;"></div>
            <div class="color-swatch" style="background-color: #3E2723;"></div>
          </div>
        </div>
        
        <div class="svg-container">
          <iframe src="output_color_squares/color_grid_London.svg" title="London coffee color grid"></iframe>
          <div class="loading-message">Loading London visualization...</div>
        </div>
      </div>

      <div class="city-container">
        <div class="city-info">
          <h3 class="city-name">Melbourne</h3>
          <p class="city-description">A palette of deep woods, warm stone, and quiet greys, echoing the city's blend of industrial edge and cozy refinement</p>
          <div class="color-palette">
            <div class="color-swatch" style="background-color: #65594F;"></div>
            <div class="color-swatch" style="background-color: #CCC0B1;"></div>
            <div class="color-swatch" style="background-color: #E0D4C2;"></div>
            <div class="color-swatch" style="background-color: #37312D;"></div>
            <div class="color-swatch" style="background-color: #948A7B;"></div>
          </div>
        </div>
        
        <div class="svg-container">
          <iframe src="output_color_squares/color_grid_Melbourne.svg" title="Melbourne coffee color grid"></iframe>
          <div class="loading-message">Loading Copenhagen visualization...</div>
        </div>
      </div>
    </div>
  </section>

  <section class="comparison-section">
    <div class="section-inner">
      <h2>Two Versions of the Brand</h2>
      <p>
        Cafés present themselves differently across platforms. Instagram showcases atmosphere: latte art, pastries, plants, pets, and morning light. Websites offer a more controlled version—emphasizing architecture, baristas, equipment, coffee products and brand identity.
      </p>
    </div>

    <div class="color-comparison">
      <div class="color-profile">
        <h3 class="color-profile-title">Average Instagram Color Profile</h3>
        <img src="city_color_profiles.svg" alt="Most common Instagram color per city (KMeans)">
      </div>
      <div class="color-profile">
        <h3 class="color-profile-title">Average Website Color Profile</h3>
        <img src="clustered_city_colors.svg" alt="Mean Instagram color per city">
      </div>
    </div>

    <div class="section-inner">
      <p>
        Instagram reflects how a café feels. A website presents how it wants to be perceived.
      </p>

      <p>
        In many Southeast Asian countries, standalone websites are rare. Instagram often functions as the café's only public presence. Bios tend to be short, slogan-like statements focused on design, location, or community. Websites, when available, include sourcing stories, sustainability claims, and design philosophies.
      </p>

      <p>Each platform serves a different function. Instagram builds desire. Websites build trust.
      </p>
    </div>
  </section>

  <section class="comparison-section">
    <div class="section-inner">
      <h2>How Cafés Present Themselves Online</h2>
      <p>
        What cafés share on Instagram often differs from what they feature on their websites. I used object detection on thousands of images from both platforms and found consistent contrasts.
      </p>
  
      <p>
        Instagram highlights daily moments. The most common visuals include dogs, latte art, desserts, and cozy corners. These images focus on atmosphere and style. Websites, in comparison, center on baristas, brewing tools, architecture, and logos. These are branding elements meant to communicate professionalism and identity.
      </p>
  
      <p>
        This divide reflects two kinds of storytelling. Instagram captures how a café feels in everyday life. Websites show how a brand wants to be seen and remembered.
      </p>
  
      <p>
        Regional patterns also stood out. In countries like Thailand, Vietnam, and Taiwan, many cafés have no standalone websites. Instead, they rely entirely on Instagram for their digital presence, adopting a social-first strategy from the start.
      </p>
    </div>

    <div class="text-comparison">
      <div class="text-profile">
        <h3 class="text-profile-title">What cafes say about themselves on Instagram</h3>
        <img src="theme_percent_horizontal_colored_instagram.svg" alt="Most common Instagram theme of text bio">
      </div>
      <div class="text-profile">
        <h3 class="text-profile-title">What cafes say about themselves on their websites</h3>
        <img src="theme_percent_horizontal_colored_website.svg" alt="Mean Instagram color per city">
      </div>
    </div>

    <div class="section-inner">
      <h3>The Digital Identity Divide</h3>

        <p>Instagram and official websites both offer insight into how third-wave cafés shape their online identities, but they serve different purposes.</p>

      <h4>Instagram: Digital Slogans</h4>
      <p>Instagram bios often act as quick, attention-grabbing statements. Many cafés highlight multiple locations, minimalist design, or community-friendly features like pet access and local events. These profiles are built for instant recognition and often feel more like slogans than detailed descriptions.</p>

      <h4>Websites: Stories & Credibility</h4>
      <p>Café websites tend to emphasize storytelling and trust. While they sometimes share themes with Instagram, such as a focus on design or local identity, websites usually go further. They highlight sourcing practices, share origin stories, and promote community values to present the brand as intentional and credible. </p>

      <h4>What This Reveals</h4>
      <p>One notable pattern is that many cafés list "no website" directly in their Instagram bios, a detail that obviously does not appear on websites. This contrast reflects how platform shapes message. Instagram promotes lifestyle and visual appeal. The website, when it exists, provides structure and meaning behind the brand.</p>

      <p>In short, Instagram is where cafés signal lifestyle and aesthetics. The website is where they explain who they are and why they matter.</p>
    </div>
  </section>

  <section class="comparison-maps">
    <div class="section-inner">
      <h2>Where Third-Wave Coffee Thrives?</h2>
      <p>
        In New York, Miami, and Dallas, café locations were compared with census data. The findings were consistent. Third-wave coffee shops tend to appear in neighborhoods with higher income, higher education levels, higher rent, and more economic inequality.
      </p>
  
      <p>
        Regression analysis confirmed these patterns. In New York, inequality and rent levels were the strongest predictors. In Dallas, property values mattered most. In Miami, educational attainment had more predictive power than income.
      </p>
    </div>

    <!-- Scrollytelling Section for Charts -->
  <section id="scrolly-charts-section" class="scrolly-container">
    <div class="sticky-thing">
      <img id="chart-step-img-0" src="charts/census_traits_by_city-01.svg" alt="Chart step 1" class="active">
      <img id="chart-step-img-1" src="charts/census_traits_by_city-02.svg" alt="Chart step 2">
      <img id="chart-step-img-2" src="charts/census_traits_by_city-03.svg" alt="Chart step 3">
      <img id="chart-step-img-3" src="charts/census_traits_by_city-04.svg" alt="Chart step 4">
      <img id="chart-step-img-4" src="charts/census_traits_by_city-05.svg" alt="Chart step 5">
      <img id="chart-step-img-5" src="charts/census_traits_by_city-01.svg" alt="Chart step 1 again">
      <!-- Overlay annotations for each chart -->
      <div class="chart-annotation" id="annotation-0"></div>
      <div class="chart-annotation" id="annotation-1"></div>
      <div class="chart-annotation" id="annotation-2"></div>
      <div class="chart-annotation" id="annotation-3"></div>
      <div class="chart-annotation" id="annotation-4"></div>
      <div class="chart-annotation" id="annotation-5"></div>
      <div class="step-textbox" id="scrolly-caption-box"></div>
    </div>
    <div class="steps-container">
      <div class="step" id="step1"><span style="display:block; height: 90vh;"></span></div>
      <div class="step" id="step2"><span style="display:block; height: 90vh;"></span></div>
      <div class="step" id="step3"><span style="display:block; height: 90vh;"></span></div>
      <div class="step" id="step4"><span style="display:block; height: 90vh;"></span></div>
      <div class="step" id="step5"><span style="display:block; height: 90vh;"></span></div>
      <div class="step" id="step6"><span style="display:block; height: 90vh;"></span></div>
    </div>
  </section>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    try {
      const scroller = scrollama();
      const captions = [
        "NYC's café neighborhoods aren't just richer — they cluster tightly at the top, meaning almost no third-wave cafés exist in lower-income areas, unlike Miami and Dallas, which have longer income \"tails.\"",
        "Dallas nearly matches NYC in education levels around cafés, even though it lags behind in income and housing, suggesting that education, not just wealth, may be a stronger predictor for third-wave presence there.",
        "Unlike NYC, where café rents cluster in a narrow, high band, Miami's café tracts span a wider range, some cafés exist in relatively affordable areas, indicating rent isn't always a barrier.",
        "Even though Dallas and Miami look similar on this chart, they're both dramatically lower than NYC, suggesting NYC cafés are deeply embedded in real estate hot zones, while others adapt to more transitional or mid-range areas.",
        "While Miami shows the most extreme inequality among the three, café neighborhoods in all cities tend to be more unequal than the national average. This suggests that third-wave coffee often thrives in areas marked by income disparity, not just uniformly affluent neighborhoods.",
        "NYC's café neighborhoods aren't just richer, they cluster tightly at the top, meaning almost no third-wave from website ThirdWaveNearMe.com cafés exist in lower-income areas, unlike Miami and Dallas."
      ];
      const annotations = [
        "Intro: High income clustering in NYC café neighborhoods",
        "Education levels: Dallas nearly matches NYC",
        "Miami café tracts: rent range is much wider",
        "NYC cafés: deeply embedded in real estate hot zones",
        "All café neighborhoods: higher inequality than US average",
        "Recap: Income clustering in NYC café neighborhoods"
      ];
      const captionBox = document.getElementById('scrolly-caption-box');
      if (!captionBox) throw new Error('Caption box not found');
      captionBox.textContent = captions[0];

      function showStep(idx) {
        for (let i = 0; i < 6; i++) {
          const img = document.getElementById('chart-step-img-' + i);
          const annotation = document.getElementById('annotation-' + i);
          if (!img) console.error('Missing image for step', i);
          if (!annotation) console.error('Missing annotation for step', i);
          if (i === idx) {
            if (img) img.classList.add('active');
            if (annotation) annotation.style.display = 'block';
          } else {
            if (img) img.classList.remove('active');
            if (annotation) annotation.style.display = 'none';
          }
        }
        captionBox.textContent = captions[idx];
      }

      // Hide all annotations except the first on load
      for (let i = 1; i < 6; i++) {
        const ann = document.getElementById('annotation-' + i);
        if (ann) ann.style.display = 'none';
      }
      const ann0 = document.getElementById('annotation-0');
      if (ann0) ann0.style.display = 'block';

      scroller
        .setup({
          parent: document.querySelector("#scrolly-charts-section"),
          step: ".step",
          offset: 0.6,
          progress: false,
          debug: false,
        })
        .onStepEnter(function ({ element, index, direction }) {
          showStep(index);
        })
        .onStepExit(function({ element, index, direction }) {
          if (direction === 'up' && index > 0) {
            showStep(index - 1);
          }
        });
      window.addEventListener("resize", scroller.resize);
      showStep(0);
    } catch (e) {
      console.error('Scrollytelling error:', e);
    }
  });
  </script>

  <div class="section-inner">
    <h3>Mapping the Coffee Footprint</h3>
  </div>

  <div class="map-pair">
    <div class="map-container">
      <div class="city-title">New York City</div>
      <img src="nyc_actual_count_map.svg" alt="NYC actual coffee locations">
      <figcaption><strong>Actual third-wave cafés</strong> in New York City</figcaption>
      <p>In New York, cafés cluster in Williamsburg, Lower Manhattan, and select parts of Brooklyn. Ridgewood and southern Harlem show early signs of growth. Coverage is sparse in the Bronx and eastern Queens.</p>
    </div>
    <div class="map-container">
      <div class="city-title">New York City</div>
      <img src="nyc_probability_map.svg" alt="NYC predicted coffee heatmap">
      <figcaption><strong>Predicted hotspots</strong> based on regression</figcaption>
      <p>Model predictions closely track reality. High-probability zones align with wealth, education, and rising rent. The model also highlights emerging pockets such as Ridgewood and southern Harlem, where cultural and economic shifts are beginning to create space for café growth.</p>
    </div>
  </div>

  <div class="map-pair">
    <div class="map-container">
      <div class="city-title">Miami</div>
      <img src="miami_actual_count_map.svg" alt="Miami actual coffee locations">
      <figcaption><strong>Actual third-wave cafés</strong> in Miami</figcaption>
      <p>In Miami, the café landscape is concentrated in Brickell, Wynwood, and Coconut Grove. Little Haiti and Liberty City, despite rich cultural histories, remain underrepresented.</p>
    </div>
    <div class="map-container">
      <div class="city-title">Miami</div>
      <img src="miami_probability_map.svg" alt="Miami predicted coffee heatmap">
      <figcaption><strong>Predicted hotspots</strong> based on regression</figcaption>
      <p>Socioeconomic indicators highlight areas poised for change. The model predicts elevated café potential in parts of Allapattah and Little River, suggesting these neighborhoods may be on the cusp of aesthetic and economic transformation.</p>
    </div>
  </div>

  <div class="map-pair">
    <div class="map-container">
      <div class="city-title">Dallas</div>
      <img src="dallas_actual_count_map.svg" alt="Dallas actual coffee locations">
      <figcaption><strong>Actual third-wave cafés</strong> in Dallas</figcaption>
      <p>Most specialty cafés are concentrated in central Dallas, particularly along Uptown, Bishop Arts, and Lower Greenville. The north–south divide is stark. Southern neighborhoods, many of which are lower-income and historically Black, show little to no café presence.</p>
    </div>
    <div class="map-container">
      <div class="city-title">Dallas</div>
      <img src="dallas_probability_map.svg" alt="Dallas predicted coffee heatmap">
      <figcaption><strong>Predicted hotspots</strong> based on regression</figcaption>
      <p>The regression model picks up more subtle signals. While it affirms high café likelihood in wealthier zones, it also identifies transitional tracts in Oak Cliff and East Dallas areas where demographic shifts are underway.</p>
    </div>
  </div>

  <div class="section-inner">
    <p>
      Café locations align with the contours of inequality and development. Each map becomes a social and economic snapshot.
    </p>
    <p> 
      In other words, third-wave coffee shops tend to show up where upward mobility meets precarity — gentrifying zones, creative enclaves, and income-diverse areas on the rise.
    </p>
  </div>
  </section>

  <section class="final-view">
    <div class="final-content collapsible-section">
      <button class="collapsible-toggle" aria-expanded="false">Conclusion</button>
      <div class="collapsible-content">
        <h2>Taste as Social Signal</h2>
        <p>
          Third-wave cafés look soft and quiet, but their design carries deeper meaning. Each element: beige walls, terrazzo surfaces, linen menus, signals inclusion in a specific cultural moment.
        </p>
        <p>
          Across continents, the same clean aesthetics surface with striking consistency. Beneath the warm wood and soft neutrals are deeper currents. These cafés tend to appear in neighborhoods undergoing change, where economic divides, cultural shifts, and new forms of labor intersect.
        </p>
        <p>
          Stepping into a beautifully lit café with ambient playlists is more than a design choice. It is an encounter with the global language of taste, a visible trace of urban transition, and a quiet sign of where the world is heading. Beige is the color that the third-wave coffee culture rides.
        </p>
        <p>And you thought beige was boring.</p>
      </div>
    </div>
  </section>

  <!-- RECODED METHODOLOGY SECTION -->
  <section class="methodology-new" aria-labelledby="methodology-title">
    <button class="methodology-toggle" id="methodology-toggle" aria-expanded="false" aria-controls="methodology-content">
      <span id="methodology-title">Methodology</span>
      <span class="methodology-toggle-icon" aria-hidden="true">+</span>
    </button>
    <div class="methodology-content-new" id="methodology-content" hidden>
      <p>This project mapped the global aesthetics and urban geography of third-wave coffee shops by combining web scraping, image captioning, OCR, multilingual translation, and census-based regression modeling. I scraped 173 city pages from ThirdWaveNearMe.com, manually extracted 164 KML files, and geocoded over 5,200 cafés. Playwright and BeautifulSoup were used to gather Instagram and website links. For cafés missing metadata, I automated Bing searches and used a fine-tuned classifier to flag likely Instagram profiles, which I then manually verified. Matching was especially difficult in non-Latin scripts like Mandarin, Japanese, and Russian; Thai cafés, by contrast, often included English names that improved match accuracy.</p>
      <p>I scraped over 5,000 Instagram accounts and 200 websites, then applied OCR and translated multilingual bios using both Google Translate and ChatGPT-4o. To analyze visual content, I used BLIP and OWL-ViT to generate captions and detect objects across 6,000 images, then clustered themes using FASTopic. Café locations were joined to census tracts in New York, Dallas, and Miami and modeled using logistic regression. High rent and home value were the most consistent predictors of café presence, while income showed a weaker or negative effect. The workflow revealed how a global design language travels across cities.</p>
    </div>
  </section>

  <footer>
    <div class="footer-content">
      <p>A visual study of third-wave coffee shop aesthetics worldwide | Data collected from 5,000+ cafés across 91 cities</p>
      <p>GitHub code: <a href="https://github.com/chilinhhovo/third-wave-coffee">github.com/chilinhhovo/third-wave-coffeee</a></p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Handle iframe loading
      const iframes = document.querySelectorAll('iframe');
      
      iframes.forEach(iframe => {
        iframe.onload = function() {
          // Hide loading message when iframe is loaded
          const loadingMessage = iframe.nextElementSibling;
          if (loadingMessage && loadingMessage.classList.contains('loading-message')) {
            loadingMessage.style.display = 'none';
          }
        };
        
        iframe.onerror = function() {
          // Show error in loading message
          const loadingMessage = iframe.nextElementSibling;
          if (loadingMessage && loadingMessage.classList.contains('loading-message')) {
            loadingMessage.textContent = 'Failed to load visualization. Please check that image paths are correct.';
          }
        };
      });
      
      // Methodology toggle


      document.querySelectorAll('.color-grid-svg').forEach(iframe => {
        iframe.onload = function() {
          const svgDoc = iframe.contentDocument;
          if (!svgDoc) return;
          const rects = svgDoc.querySelectorAll('rect');
          rects.forEach(rect => {
            rect.addEventListener('mouseenter', function() {
              const color = rect.getAttribute('fill');
              const tooltip = document.getElementById('colorTooltip');
              tooltip.textContent = color;
              tooltip.style.display = 'block';
            });
            rect.addEventListener('mouseleave', function() {
              document.getElementById('colorTooltip').style.display = 'none';
            });
          });
        };
      });

      // Collapsible sections for mobile
      document.querySelectorAll('.collapsible-toggle').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var section = btn.closest('.collapsible-section');
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', !expanded);
          section.classList.toggle('active');
        });
      });

      // Simple zoom in/out for all city maps
      document.querySelectorAll('.zoom-in').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          var mapId = btn.getAttribute('data-map');
          var img = document.getElementById(mapId);
          if (!img) return;
          var current = parseFloat(img.getAttribute('data-zoom'));
          if (isNaN(current)) current = 1;
          var next = current + 0.2;
          if (next > 5) next = 5;
          img.style.transform = 'scale(' + next + ')';
          img.setAttribute('data-zoom', next);
        });
      });
      document.querySelectorAll('.zoom-out').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          var mapId = btn.getAttribute('data-map');
          var img = document.getElementById(mapId);
          if (!img) return;
          var current = parseFloat(img.getAttribute('data-zoom'));
          if (isNaN(current)) current = 1;
          var next = current - 0.2;
          if (next < 0.2) next = 0.2;
          img.style.transform = 'scale(' + next + ')';
          img.setAttribute('data-zoom', next);
        });
      });

      // Improved scrollytelling for chart fade in/out
      var scrollyContainer = document.getElementById('scrolly-charts');
      if (!scrollyContainer) return;
      var chart1 = document.getElementById('scrolly-chart-1');
      var chart2 = document.getElementById('scrolly-chart-2');
      function onScroll() {
        var rect = scrollyContainer.getBoundingClientRect();
        var vh = window.innerHeight || document.documentElement.clientHeight;
        var midpoint = vh / 2;
        var start = rect.top;
        var end = rect.bottom;
        // Only one chart visible at a time, based on scroll position
        if (midpoint < start) {
          // Before container: show first chart only
          chart1.classList.add('active');
          chart2.classList.remove('active');
        } else if (midpoint >= start && midpoint < end - rect.height / 2) {
          // In first half: show first chart
          chart1.classList.add('active');
          chart2.classList.remove('active');
        } else if (midpoint >= end - rect.height / 2 && midpoint < end) {
          // In second half: show second chart
          chart1.classList.remove('active');
          chart2.classList.add('active');
        } else {
          // After container: show second chart only
          chart1.classList.remove('active');
          chart2.classList.add('active');
        }
      }
      window.addEventListener('scroll', onScroll);
      window.addEventListener('resize', onScroll);
      onScroll();
    });
  </script>

  <!-- Add Scrollama and D3.js -->
  <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/3.2.0/scrollama.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js"></script>


  <!-- Standalone methodology toggle script (always runs last) -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
  // First, let's hide all horizontal lines that might be causing the brown lines
  const horizontalLines = document.querySelectorAll('hr');
  horizontalLines.forEach(line => {
    line.style.display = 'none';
  });
  
  // Also let's hide any other elements that might be causing horizontal lines
  const mapPair = document.querySelectorAll('.map-pair');
  mapPair.forEach(pair => {
    const horizontalDividers = pair.querySelectorAll('hr, .divider');
    horizontalDividers.forEach(divider => {
      divider.style.display = 'none';
    });
  });
  
  // Fix methodology toggle functionality
  const methodologyHeader = document.querySelector('.methodology-header');
  const methodologyContent = document.querySelector('.methodology-content');
  const toggleBtn = document.querySelector('.toggle-btn');
  
  if (methodologyHeader && methodologyContent && toggleBtn) {
    // Make sure the methodology content starts hidden
    methodologyContent.style.display = 'none';
    
    // Add proper event listener
    methodologyHeader.addEventListener('click', function() {
      // Toggle the active class
      methodologyContent.classList.toggle('active');
      
      // Also explicitly toggle display style for compatibility
      if (methodologyContent.classList.contains('active')) {
        methodologyContent.style.display = 'block';
        toggleBtn.textContent = '−';
      } else {
        methodologyContent.style.display = 'none';
        toggleBtn.textContent = '+';
      }
    });
  }

  // Rest of your existing code...
});
  </script>
  <!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
      var methodologyHeader = document.querySelector('.methodology-header');
      var methodologyContent = document.querySelector('.methodology-content');
      var toggleBtn = document.querySelector('.toggle-btn');
      if (methodologyHeader && methodologyContent && toggleBtn) {
        methodologyHeader.addEventListener('click', function() {
          methodologyContent.classList.toggle('active');
          toggleBtn.textContent = methodologyContent.classList.contains('active') ? '−' : '+';
        });
      }
    });
  </script> -->
  <!-- <script>document.addEventListener('DOMContentLoaded', function() {
  const methodologyHeader = document.querySelector('.methodology-header');
  const methodologyContent = document.querySelector('.methodology-content');
  const toggleBtn = document.querySelector('.toggle-btn');
  
  if (methodologyHeader && methodologyContent && toggleBtn) {
    methodologyHeader.addEventListener('click', function() {
      methodologyContent.classList.toggle('active');
      toggleBtn.textContent = methodologyContent.classList.contains('active') ? '−' : '+';
    });
  } else {
    console.error('Methodology elements not found');
  }
});</script> -->

  <!-- Standalone methodology toggle script for new section -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    var toggle = document.getElementById('methodology-toggle');
    var content = document.getElementById('methodology-content');
    var icon = toggle.querySelector('.methodology-toggle-icon');
    toggle.addEventListener('click', function() {
      var expanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', !expanded);
      if (!expanded) {
        content.hidden = false;
        icon.textContent = '−';
      } else {
        content.hidden = true;
        icon.textContent = '+';
      }
    });
  });
  </script>


  <style>
  .methodology-static {
    display: inline-block;
    background: #f0e7de;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(139, 69, 19, 0.07);
    padding: 0 0 1.2rem 0;
    margin: 3rem auto 2rem auto;
    min-width: 320px;
    max-width: 98vw;
  }
  .methodology-static h2 {
    background: #8B4513;
    color: #fff;
    font-size: 1.2rem;
    font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    font-weight: 700;
    border-radius: 8px 8px 0 0;
    margin: 0;
    padding: 0.8rem 1.2rem;
  }
  .methodology-content-static {
    padding: 1.2rem 1.2rem 0.5rem 1.2rem;
    background: #fff;
    border-radius: 0 0 8px 8px;
    color: #2d2320;
    font-size: 1.02rem;
    font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
  }
  </style>
</body>
</html>